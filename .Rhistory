v.names   = 'cases',
times     = names(d.dea)[5:ncol(d.dea)],
direction = 'long') %>%
dplyr::mutate(date = lubridate::mdy(stringr::str_replace_all(time, 'X', '')),
type = rep('death', (ncol(d.dea)-4)*nrow(d.dea))) %>%
dplyr::select(1, 2, 3, 4, 6, 7, 8, 9)
# - Cumulative final data in long format
covid.cum <- rbind(d.con.long, d.rec.long, d.dea.long)
#___________________________________________________________________Data 3 daily
# - Daily cases by type in wide format
d.con.daily <- cbind(d.con[, 1:5], # first day, today - yesterday
d.con[, 6:ncol(d.con)] - d.con[, 5:(ncol(d.con)-1)])
d.rec.daily <- cbind(d.rec[, 1:5],
d.rec[, 6:ncol(d.rec)] - d.rec[, 5:(ncol(d.rec)-1)])
d.dea.daily <- cbind(d.dea[, 1:5],
d.dea[, 6:ncol(d.dea)] - d.dea[, 5:(ncol(d.dea)-1)])
# - Confirmed cases in long format
d.con.daily.l <- reshape(data      = d.con.daily,
varying   = names(d.con.daily)[5:ncol(d.con.daily)],
v.names   = 'cases',
times     = names(d.con.daily)[5:ncol(d.con.daily)],
direction = 'long') %>%
dplyr::mutate(date = lubridate::mdy(stringr::str_replace_all(time, 'X', '')),
type = rep('confirmed',
(ncol(d.con.daily)-4)*nrow(d.con.daily))) %>%
dplyr::select(1, 2, 3, 4, 6, 7, 8, 9)
# - Recovered
d.rec.daily.l <- reshape(data      = d.rec.daily,
varying   = names(d.rec.daily)[5:ncol(d.rec.daily)],
v.names   = 'cases',
times     = names(d.rec.daily)[5:ncol(d.rec.daily)],
direction = 'long') %>%
dplyr::mutate(date = lubridate::mdy(stringr::str_replace_all(time, 'X', '')),
type = rep('recovered',
(ncol(d.rec.daily)-4)*nrow(d.rec.daily))) %>%
dplyr::select(1, 2, 3, 4, 6, 7, 8, 9)
# - Death
d.dea.daily.l <- reshape(data      = d.dea.daily,
varying   = names(d.dea.daily)[5:ncol(d.dea.daily)],
v.names   = 'cases',
times     = names(d.dea.daily)[5:ncol(d.dea.daily)],
direction = 'long') %>%
dplyr::mutate(date = lubridate::mdy(stringr::str_replace_all(time, 'X', '')),
type = rep('death',
(ncol(d.dea.daily)-4)*nrow(d.dea.daily))) %>%
dplyr::select(1, 2, 3, 4, 6, 7, 8, 9)
# - Daily final data long
coronavirus <- rbind(d.con.daily.l, d.rec.daily.l, d.dea.daily.l)
#___________________________________________________________Data 4 BR por Estado
# dbr.munic <-
#   read.csv(url("https://brasil.io/dataset/covid19/caso?format=csv")) %>%
#   dplyr::mutate(date = as.Date(date))
#
# dbr.estado <- dbr.munic %>%
#   dplyr::filter(place_type == "state") %>%
#   dplyr::select(-city)
#_________________________________________________________Data 5 population size
# Fonte: https://data.worldbank.org/indicator/SP.POP.TOTL
d.pop <- read.csv(url("https://raw.githubusercontent.com/grequena/coronavirusBR/master/popsize.csv"), sep = ';', header = TRUE)
# - Select only countries in coronavirus data
d.pop <- d.pop %>%
dplyr::filter(Country.Name %in% levels(coronavirus$Country.Region)) %>%
dplyr::arrange(Country.Name) %>%
dplyr::mutate(Country.Name = factor(Country.Name, levels =
c(levels(Country.Name), "Americas",
"Asia", "Africa", "Oceania",
"Europe","World")))
#___________________________________________________________Data 4 BR por Estado
# dbr.munic <-
#   read.csv(url("https://brasil.io/dataset/covid19/caso?format=csv")) %>%
#   dplyr::mutate(date = as.Date(date))
#
# dbr.estado <- dbr.munic %>%
#   dplyr::filter(place_type == "state") %>%
#   dplyr::select(-city)
#_________________________________________________________Data 5 population size
# Fonte: https://data.worldbank.org/indicator/SP.POP.TOTL
d.pop <- read.csv(url("https://raw.githubusercontent.com/grequena/coronavirusBR/master/popsize.csv"), sep = ';', header = TRUE)
# - Select only countries in coronavirus data
d.pop <- d.pop %>%
dplyr::filter(Country.Name %in% levels(coronavirus$Country.Region)) %>%
dplyr::arrange(Country.Name) %>%
dplyr::mutate(Country.Name = factor(Country.Name, levels =
c(levels(Country.Name), "Americas",
"Asia", "Africa", "Oceania",
"Europe")))
# - Check
# levels(coronavirus$Country.Region) == d.pop$Country.Name
# - Add total pop by continent and world
# Fonte: https://population.un.org/wpp/
d.pop[nrow(d.pop)+1, 1] <- "Americas"
d.pop[nrow(d.pop), 2] <- 579024000+422535000
d.pop[nrow(d.pop)+1, 1] <- "Asia"
d.pop[nrow(d.pop), 2] <- 4581757408
d.pop[nrow(d.pop)+1, 1] <- "Africa"
d.pop[nrow(d.pop), 2] <- 1216130000
d.pop[nrow(d.pop)+1, 1] <- "Europe"
d.pop[nrow(d.pop), 2] <- 738849000
d.pop[nrow(d.pop)+1, 1] <- "Oceania"
d.pop[nrow(d.pop), 2] <- 38304000
d.pop[nrow(d.pop)+1, 1] <- "World"
d.pop[nrow(d.pop), 2] <- 7576599408
#_______________________________________________________________________________
#_______________________________________________________________________________
#----------------------------------------------------------Data manipulation----
#_________________________________________________________________________CR
# - Total number of cases in CR (sum for all dates)
dfCR <- coronavirus %>%
dplyr::filter(Country.Region == "Costa Rica") %>%
dplyr::group_by(Country.Region, type) %>%
dplyr::summarise(total = sum(cases)) %>%
tidyr::pivot_wider(names_from = type, values_from = total)
# - Daily cases in CR (cases per date)
df_dailyCR <- coronavirus %>%
dplyr::filter(Country.Region == "Costa Rica") %>%
dplyr::group_by(date, type) %>%
dplyr::summarise(total = sum(cases, na.rm = TRUE)) %>%
tidyr::pivot_wider(names_from = type,
values_from = total) %>%
dplyr::arrange(date) %>%
dplyr::ungroup() %>%
dplyr::mutate(confirmed_cum = cumsum(confirmed),
death_cum = cumsum(death),
recovered_cum = cumsum(recovered))
#_______________________________________________________________________________
#_______________________________________________________________________________
#----------------------------------------------------------Data manipulation----
#_________________________________________________________________________CR
# - Total number of cases in CR (sum for all dates)
dfCR <- coronavirus %>%
dplyr::filter(Country.Region == "Costa Rica") %>%
dplyr::group_by(Country.Region, type) %>%
dplyr::summarise(total = sum(cases)) %>%
tidyr::pivot_wider(names_from = type, values_from = total)
library(tidyr)
?pivot_wider
??pivot_wider
install.packages(c("astsa", "backports", "BH", "blogdown", "bookdown", "boot", "broom", "callr", "car", "carData", "class", "cli", "clipr", "cluster", "covr", "crosstalk", "curl", "data.table", "DBI", "dbplyr", "devtools", "digest", "doParallel", "doSNOW", "dplyr", "DT", "fansi", "fBasics", "forcats", "foreach", "forecast", "fracdiff", "fs", "ggformula", "ggplot2", "ggrepel", "ggstance", "gh", "git2r", "glue", "gss", "haven", "hms", "htmlwidgets", "httr", "iterators", "jsonlite", "KernSmooth", "knitr", "later", "lattice", "leaflet", "lme4", "lmtest", "lubridate", "maptools", "MASS", "Matrix", "mgcv", "mime", "mnormt", "modelr", "mosaic", "nlme", "nloptr", "nnet", "numDeriv", "openssl", "openxlsx", "pillar", "pkgbuild", "pkgconfig", "plyr", "prettyunits", "processx", "progress", "promises", "ps", "purrr", "quadprog", "quantmod", "quantreg", "R6", "raster", "Rcpp", "RcppArmadillo", "RcppEigen", "RCurl", "remotes", "reprex", "reshape2", "rex", "RJSONIO", "rlang", "rmarkdown", "roxygen2", "rpart", "rstudioapi", "rversions", "rvest", "scales", "selectr", "servr", "sf", "shiny", "sn", "sp", "SparseM", "spatial", "stringi", "survival", "sys", "systemfonts", "testthat", "tibble", "tidyr", "tidyselect", "tidyverse", "timeSeries", "tinytex", "tseries", "TTR", "usethis", "whisker", "withr", "xaringan", "xfun", "xml2", "xts", "yaml", "zip", "zoo"))
library(flexdashboard)
# library(tidyverse)
# library(shiny)
# library(plotly)
# library(countrycode)
# library(lubridate)
# library(dplyr)
# library(magrittr)
# library(hrbrthemes)
# library(viridis)
# library(ggplot2)
# library(ggiraph)
#_____________________________________________________________________Parameters
# - Set colors
confirmed_color <- rgb(20, 120, 190, maxColorValue = 255)
death_color     <- rgb(220, 40, 40,  maxColorValue = 255, alpha = 230)
recovered_color <- rgb(10, 120, 10,  maxColorValue = 255, alpha = 230)
confirmed_colorT <- rgb(20, 120, 190, maxColorValue = 255, alpha = 190)
death_colorT     <- rgb(220, 40, 40,  maxColorValue = 255, alpha = 190)
recovered_colorT <- rgb(10, 120, 10,  maxColorValue = 255, alpha = 190)
# - Use %>% directly
`%>%` <- magrittr::`%>%`
#_________________________________________________________________________Data 1
# install.packages("devtools")
# devtools::install_github("RamiKrispin/coronavirus")
# coronavirus::update_datasets(silence = TRUE)
# library(coronavirus)
# data(coronavirus)
# max(coronavirus$date)
#______________________________________________________________Data 2 cumulative
# - Confirmed cases in wide format
d.con <- read.csv(url("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv"))
# - Recovered
d.rec <- read.csv(url("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_recovered_global.csv"))
# - Death
d.dea <- read.csv(url("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_global.csv"))
# - Confirmed cases in long format
d.con.long <- reshape(data      = d.con,
varying   = names(d.con)[5:ncol(d.con)],
v.names   = 'cases',
times     = names(d.con)[5:ncol(d.con)],
direction = 'long') %>%
dplyr::mutate(date = lubridate::mdy(stringr::str_replace_all(time, 'X', '')),
type = rep('confirmed', (ncol(d.con)-4)*nrow(d.con))) %>%
dplyr::select(1, 2, 3, 4, 6, 7, 8, 9)
# - Recovered
d.rec.long <- reshape(data      = d.rec,
varying   = names(d.rec)[5:ncol(d.rec)],
v.names   = 'cases',
times     = names(d.rec)[5:ncol(d.rec)],
direction = 'long') %>%
dplyr::mutate(date = lubridate::mdy(stringr::str_replace_all(time, 'X', '')),
type = rep('recovered', (ncol(d.rec)-4)*nrow(d.rec))) %>%
dplyr::select(1, 2, 3, 4, 6, 7, 8, 9)
# - Death
d.dea.long <- reshape(data      = d.dea,
varying   = names(d.dea)[5:ncol(d.dea)],
v.names   = 'cases',
times     = names(d.dea)[5:ncol(d.dea)],
direction = 'long') %>%
dplyr::mutate(date = lubridate::mdy(stringr::str_replace_all(time, 'X', '')),
type = rep('death', (ncol(d.dea)-4)*nrow(d.dea))) %>%
dplyr::select(1, 2, 3, 4, 6, 7, 8, 9)
# - Cumulative final data in long format
covid.cum <- rbind(d.con.long, d.rec.long, d.dea.long)
#___________________________________________________________________Data 3 daily
# - Daily cases by type in wide format
d.con.daily <- cbind(d.con[, 1:5], # first day, today - yesterday
d.con[, 6:ncol(d.con)] - d.con[, 5:(ncol(d.con)-1)])
d.rec.daily <- cbind(d.rec[, 1:5],
d.rec[, 6:ncol(d.rec)] - d.rec[, 5:(ncol(d.rec)-1)])
d.dea.daily <- cbind(d.dea[, 1:5],
d.dea[, 6:ncol(d.dea)] - d.dea[, 5:(ncol(d.dea)-1)])
# - Confirmed cases in long format
d.con.daily.l <- reshape(data      = d.con.daily,
varying   = names(d.con.daily)[5:ncol(d.con.daily)],
v.names   = 'cases',
times     = names(d.con.daily)[5:ncol(d.con.daily)],
direction = 'long') %>%
dplyr::mutate(date = lubridate::mdy(stringr::str_replace_all(time, 'X', '')),
type = rep('confirmed',
(ncol(d.con.daily)-4)*nrow(d.con.daily))) %>%
dplyr::select(1, 2, 3, 4, 6, 7, 8, 9)
# - Recovered
d.rec.daily.l <- reshape(data      = d.rec.daily,
varying   = names(d.rec.daily)[5:ncol(d.rec.daily)],
v.names   = 'cases',
times     = names(d.rec.daily)[5:ncol(d.rec.daily)],
direction = 'long') %>%
dplyr::mutate(date = lubridate::mdy(stringr::str_replace_all(time, 'X', '')),
type = rep('recovered',
(ncol(d.rec.daily)-4)*nrow(d.rec.daily))) %>%
dplyr::select(1, 2, 3, 4, 6, 7, 8, 9)
# - Death
d.dea.daily.l <- reshape(data      = d.dea.daily,
varying   = names(d.dea.daily)[5:ncol(d.dea.daily)],
v.names   = 'cases',
times     = names(d.dea.daily)[5:ncol(d.dea.daily)],
direction = 'long') %>%
dplyr::mutate(date = lubridate::mdy(stringr::str_replace_all(time, 'X', '')),
type = rep('death',
(ncol(d.dea.daily)-4)*nrow(d.dea.daily))) %>%
dplyr::select(1, 2, 3, 4, 6, 7, 8, 9)
# - Daily final data long
coronavirus <- rbind(d.con.daily.l, d.rec.daily.l, d.dea.daily.l)
# - Check if data is updated
# max(coronavirus$date)
#___________________________________________________________Data 4 BR por Estado
# dbr.munic <-
#   read.csv(url("https://brasil.io/dataset/covid19/caso?format=csv")) %>%
#   dplyr::mutate(date = as.Date(date))
#
# dbr.estado <- dbr.munic %>%
#   dplyr::filter(place_type == "state") %>%
#   dplyr::select(-city)
#_________________________________________________________Data 5 population size
# Fonte: https://data.worldbank.org/indicator/SP.POP.TOTL
d.pop <- read.csv(url("https://raw.githubusercontent.com/grequena/coronavirusBR/master/popsize.csv"), sep = ';', header = TRUE)
# - Select only countries in coronavirus data
d.pop <- d.pop %>%
dplyr::filter(Country.Name %in% levels(coronavirus$Country.Region)) %>%
dplyr::arrange(Country.Name) %>%
dplyr::mutate(Country.Name = factor(Country.Name, levels =
c(levels(Country.Name), "Americas",
"Asia", "Africa", "Oceania",
"Europe")))
# - Check
# levels(coronavirus$Country.Region) == d.pop$Country.Name
# - Add total pop by continent and world
# Fonte: https://population.un.org/wpp/
d.pop[nrow(d.pop)+1, 1] <- "Americas"
d.pop[nrow(d.pop), 2] <- 579024000+422535000
d.pop[nrow(d.pop)+1, 1] <- "Asia"
d.pop[nrow(d.pop), 2] <- 4581757408
d.pop[nrow(d.pop)+1, 1] <- "Africa"
d.pop[nrow(d.pop), 2] <- 1216130000
d.pop[nrow(d.pop)+1, 1] <- "Europe"
d.pop[nrow(d.pop), 2] <- 738849000
d.pop[nrow(d.pop)+1, 1] <- "Oceania"
d.pop[nrow(d.pop), 2] <- 38304000
d.pop[nrow(d.pop)+1, 1] <- "World"
d.pop[nrow(d.pop), 2] <- 7576599408
#_______________________________________________________________________________
#_______________________________________________________________________________
#----------------------------------------------------------Data manipulation----
#_________________________________________________________________________CR
# - Total number of cases in CR (sum for all dates)
dfCR <- coronavirus %>%
dplyr::filter(Country.Region == "Costa Rica") %>%
dplyr::group_by(Country.Region, type) %>%
dplyr::summarise(total = sum(cases)) %>%
tidyr::pivot_wider(names_from = type, values_from = total)
# - Daily cases in CR (cases per date)
df_dailyCR <- coronavirus %>%
dplyr::filter(Country.Region == "Costa Rica") %>%
dplyr::group_by(date, type) %>%
dplyr::summarise(total = sum(cases, na.rm = TRUE)) %>%
tidyr::pivot_wider(names_from = type,
values_from = total) %>%
dplyr::arrange(date) %>%
dplyr::ungroup() %>%
dplyr::mutate(confirmed_cum = cumsum(confirmed),
death_cum = cumsum(death),
recovered_cum = cumsum(recovered))
#__________________________________________________________________________World
# - Total cases by country (sum for all dates)
df <- coronavirus %>%
dplyr::group_by(Country.Region, type) %>%
dplyr::summarise(total = sum(cases)) %>%
tidyr::pivot_wider(names_from = type, values_from = total) %>%
dplyr::arrange(-confirmed)
# - Daily cases in world (sum for all countries)
df_daily <- coronavirus %>%
dplyr::group_by(date, type) %>%
dplyr::summarise(total = sum(cases, na.rm = TRUE)) %>%
tidyr::pivot_wider(names_from = type,
values_from = total) %>%
dplyr::arrange(date) %>%
dplyr::ungroup() %>%
dplyr::mutate(confirmed_cum = cumsum(confirmed),
death_cum = cumsum(death),
recovered_cum = cumsum(recovered))
# - Daily cases by country
df_pais <- coronavirus %>%
dplyr::group_by(Country.Region, date, type) %>%
dplyr::summarise(total = sum(cases)) %>%
tidyr::pivot_wider(names_from = type, values_from = total) %>%
dplyr::arrange(date) %>%
dplyr::ungroup() %>%
dplyr::group_by(Country.Region) %>%
dplyr::mutate(confirmed_cum = cumsum(confirmed),
death_cum = cumsum(death),
recovered_cum = cumsum(recovered))
#_____________________________________________________________Daily by continent
# - Vector with all countries to extract `continent`
country <- as.character(levels(coronavirus$Country.Region))
country[country == "Kosovo"] <- "Russia" #so the function below results "Europe"
country[country == "Diamond Princess"] <- "Japan" #ship was in Yokohama port
#                                                  counts for "Asia", not Japan
country[country == "MS Zaandam"] <- "US" #more complicated but it's in "America"
# - Continent from the vector country
continent <- countrycode::countrycode(sourcevar = country,
origin = "country.name",
destination = "continent")
# - Data
df_cont <- df_pais
levels(df_cont$Country.Region) <- continent #now `Country.Region` is `continent`
df_cont <- df_cont %>%
dplyr::group_by(Country.Region, date) %>%
dplyr::summarise(confirmed = sum(confirmed,na.rm = T), #by continent and date
recovered = sum(recovered,na.rm = T),
death = sum(death,na.rm = T)) %>%
dplyr::arrange(date)  %>%
dplyr::mutate(confirmed_cum = cumsum(confirmed), #still by continent and date
death_cum = cumsum(death),
recovered_cum = cumsum(recovered)) %>%
dplyr::ungroup()
df_cont$continent <- df_cont$Country.Region #create the variable continent
flexdashboard::valueBox(
value = format(dfCR$confirmed, big.mark = ".", decimal.mark = ","),
caption = paste("Confirmados en Costa Rica  â€¢ ",
as.character.POSIXt(max(coronavirus$date),
format = "%d/%m/%Y")),
icon = "fas fa-diagnoses",
color = confirmed_color
)
install.packages(c("countrycode", "dplyr", "DT", "flexdashboard", "ggplot2", "htmltools", "knitr", "leaflet", "leafpop", "lubridate", "magrittr", "plotly", "purrr", "stringr", "tidyr", "viridis"))
#_______________________________________________________________________________
#_______________________________________________________________________________
#---------------------------------------------------Loading package and data----
#_______________________________________________________________________Packages
library(flexdashboard)
# library(countrycode)
# library(lubridate)
# library(dplyr)
# library(magrittr)
# library(hrbrthemes)
# library(viridis)
# library(ggplot2)
# library(ggiraph)
#_____________________________________________________________________Parameters
# - Set colors
confirmed_color <- rgb(20, 120, 190, maxColorValue = 255)
death_color     <- rgb(220, 40, 40,  maxColorValue = 255, alpha = 230)
recovered_color <- rgb(10, 120, 10,  maxColorValue = 255, alpha = 230)
confirmed_colorT <- rgb(20, 120, 190, maxColorValue = 255, alpha = 190)
death_colorT     <- rgb(220, 40, 40,  maxColorValue = 255, alpha = 190)
recovered_colorT <- rgb(10, 120, 10,  maxColorValue = 255, alpha = 190)
# - Use %>% directly
`%>%` <- magrittr::`%>%`
#_________________________________________________________________________Data 1
# install.packages("devtools")
# devtools::install_github("RamiKrispin/coronavirus")
# coronavirus::update_datasets(silence = TRUE)
# library(coronavirus)
# data(coronavirus)
# max(coronavirus$date)
#______________________________________________________________Data 2 cumulative
# - Confirmed cases in wide format
d.con <- read.csv(url("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv"))
# - Recovered
d.rec <- read.csv(url("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_recovered_global.csv"))
# - Death
d.dea <- read.csv(url("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_global.csv"))
# - Confirmed cases in long format
d.con.long <- reshape(data      = d.con,
varying   = names(d.con)[5:ncol(d.con)],
v.names   = 'cases',
times     = names(d.con)[5:ncol(d.con)],
direction = 'long') %>%
dplyr::mutate(date = lubridate::mdy(stringr::str_replace_all(time, 'X', '')),
type = rep('confirmed', (ncol(d.con)-4)*nrow(d.con))) %>%
dplyr::select(1, 2, 3, 4, 6, 7, 8, 9)
# - Recovered
d.rec.long <- reshape(data      = d.rec,
varying   = names(d.rec)[5:ncol(d.rec)],
v.names   = 'cases',
times     = names(d.rec)[5:ncol(d.rec)],
direction = 'long') %>%
dplyr::mutate(date = lubridate::mdy(stringr::str_replace_all(time, 'X', '')),
type = rep('recovered', (ncol(d.rec)-4)*nrow(d.rec))) %>%
dplyr::select(1, 2, 3, 4, 6, 7, 8, 9)
# - Death
d.dea.long <- reshape(data      = d.dea,
varying   = names(d.dea)[5:ncol(d.dea)],
v.names   = 'cases',
times     = names(d.dea)[5:ncol(d.dea)],
direction = 'long') %>%
dplyr::mutate(date = lubridate::mdy(stringr::str_replace_all(time, 'X', '')),
type = rep('death', (ncol(d.dea)-4)*nrow(d.dea))) %>%
dplyr::select(1, 2, 3, 4, 6, 7, 8, 9)
# - Cumulative final data in long format
covid.cum <- rbind(d.con.long, d.rec.long, d.dea.long)
#___________________________________________________________________Data 3 daily
# - Daily cases by type in wide format
d.con.daily <- cbind(d.con[, 1:5], # first day, today - yesterday
d.con[, 6:ncol(d.con)] - d.con[, 5:(ncol(d.con)-1)])
d.rec.daily <- cbind(d.rec[, 1:5],
d.rec[, 6:ncol(d.rec)] - d.rec[, 5:(ncol(d.rec)-1)])
d.dea.daily <- cbind(d.dea[, 1:5],
d.dea[, 6:ncol(d.dea)] - d.dea[, 5:(ncol(d.dea)-1)])
# - Confirmed cases in long format
d.con.daily.l <- reshape(data      = d.con.daily,
varying   = names(d.con.daily)[5:ncol(d.con.daily)],
v.names   = 'cases',
times     = names(d.con.daily)[5:ncol(d.con.daily)],
direction = 'long') %>%
dplyr::mutate(date = lubridate::mdy(stringr::str_replace_all(time, 'X', '')),
type = rep('confirmed',
(ncol(d.con.daily)-4)*nrow(d.con.daily))) %>%
dplyr::select(1, 2, 3, 4, 6, 7, 8, 9)
# - Recovered
d.rec.daily.l <- reshape(data      = d.rec.daily,
varying   = names(d.rec.daily)[5:ncol(d.rec.daily)],
v.names   = 'cases',
times     = names(d.rec.daily)[5:ncol(d.rec.daily)],
direction = 'long') %>%
dplyr::mutate(date = lubridate::mdy(stringr::str_replace_all(time, 'X', '')),
type = rep('recovered',
(ncol(d.rec.daily)-4)*nrow(d.rec.daily))) %>%
dplyr::select(1, 2, 3, 4, 6, 7, 8, 9)
# - Death
d.dea.daily.l <- reshape(data      = d.dea.daily,
varying   = names(d.dea.daily)[5:ncol(d.dea.daily)],
v.names   = 'cases',
times     = names(d.dea.daily)[5:ncol(d.dea.daily)],
direction = 'long') %>%
dplyr::mutate(date = lubridate::mdy(stringr::str_replace_all(time, 'X', '')),
type = rep('death',
(ncol(d.dea.daily)-4)*nrow(d.dea.daily))) %>%
dplyr::select(1, 2, 3, 4, 6, 7, 8, 9)
# - Daily final data long
coronavirus <- rbind(d.con.daily.l, d.rec.daily.l, d.dea.daily.l)
#___________________________________________________________Data 4 BR por Estado
# dbr.munic <-
#   read.csv(url("https://brasil.io/dataset/covid19/caso?format=csv")) %>%
#   dplyr::mutate(date = as.Date(date))
#
# dbr.estado <- dbr.munic %>%
#   dplyr::filter(place_type == "state") %>%
#   dplyr::select(-city)
#_________________________________________________________Data 5 population size
# Fonte: https://data.worldbank.org/indicator/SP.POP.TOTL
d.pop <- read.csv(url("https://raw.githubusercontent.com/grequena/coronavirusBR/master/popsize.csv"), sep = ';', header = TRUE)
# - Select only countries in coronavirus data
d.pop <- d.pop %>%
dplyr::filter(Country.Name %in% levels(coronavirus$Country.Region)) %>%
dplyr::arrange(Country.Name) %>%
dplyr::mutate(Country.Name = factor(Country.Name, levels =
c(levels(Country.Name), "Americas",
"Asia", "Africa", "Oceania",
"Europe")))
# - Check
# levels(coronavirus$Country.Region) == d.pop$Country.Name
# - Add total pop by continent and world
# Fonte: https://population.un.org/wpp/
d.pop[nrow(d.pop)+1, 1] <- "Americas"
d.pop[nrow(d.pop), 2] <- 579024000+422535000
d.pop[nrow(d.pop)+1, 1] <- "Asia"
d.pop[nrow(d.pop), 2] <- 4581757408
d.pop[nrow(d.pop)+1, 1] <- "Africa"
d.pop[nrow(d.pop), 2] <- 1216130000
d.pop[nrow(d.pop)+1, 1] <- "Europe"
d.pop[nrow(d.pop), 2] <- 738849000
d.pop[nrow(d.pop)+1, 1] <- "Oceania"
d.pop[nrow(d.pop), 2] <- 38304000
d.pop[nrow(d.pop)+1, 1] <- "World"
d.pop[nrow(d.pop), 2] <- 7576599408
levels(coronavirus$Country.Region)
coronavirus$Country.Region
class(coronavirus$Country.Region)
class(coronavirus)
str(coronavirus)
str(d.con)
